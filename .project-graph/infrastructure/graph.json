{
  "metadata": {
    "version": "2.0.1",
    "generated_at": "2025-11-18",
    "graph_id": "infrastructure",
    "graph_name": "Infrastructure & Automation",
    "graph_type": "specialized",
    "project_name": "telegram-bot-stack",
    "description": "CI/CD pipelines, GitHub workflows, and automation scripts",
    "scope": "Infrastructure, automation, and DevOps tooling",
    "router_file": "graph-router.json",
    "related_graphs": [
      "bot-framework-graph.json - for code being tested/deployed",
      "testing-graph.json - for test automation",
      "project-meta-graph.json - for build system overview"
    ]
  },
  "statistics": {
    "total_scripts": 17,
    "total_workflows": 3,
    "lines_of_code": 3700,
    "automation_coverage": "PR, Issues, Release, Testing, Merging, PyPI Publishing",
    "github_api_usage": "extensive"
  },
  "components": {
    "workflows": {
      "tests.yml": {
        "path": ".github/workflows/tests.yml",
        "description": "CI/CD pipeline for running tests",
        "triggers": [
          "push",
          "pull_request"
        ],
        "jobs": [
          "test"
        ],
        "python_versions": [
          "3.9",
          "3.10",
          "3.11",
          "3.12"
        ],
        "key_steps": [
          "Setup Python",
          "Install dependencies",
          "Run pytest with coverage",
          "Run ruff linting",
          "Run mypy type checking"
        ],
        "outputs": "Test results, coverage report",
        "criticality": "critical",
        "frequency": "every push/PR"
      },
      "release.yml": {
        "path": ".github/workflows/release.yml",
        "description": "Automated release workflow with semantic versioning",
        "triggers": [
          "push to main (after tests pass)"
        ],
        "jobs": [
          "release"
        ],
        "key_steps": [
          "Semantic Release analysis",
          "Version bump based on conventional commits",
          "Create GitHub release",
          "Update CHANGELOG.md",
          "Build and publish to PyPI"
        ],
        "outputs": "New version tag, GitHub release, PyPI package",
        "criticality": "critical",
        "frequency": "on main merge with feat/fix commits"
      },
      "pypi-publish.yml": {
        "path": ".github/workflows/pypi-publish.yml",
        "description": "Publish package to PyPI",
        "triggers": [
          "release (published)",
          "workflow_dispatch"
        ],
        "jobs": [
          "publish"
        ],
        "key_steps": [
          "Build package",
          "Run tests",
          "Publish to PyPI/TestPyPI"
        ],
        "outputs": "PyPI package",
        "criticality": "high",
        "frequency": "on release or manual dispatch"
      }
    },
    "automation_scripts": {
      "github_helper.py": {
        "path": ".github/workflows/scripts/github_helper.py",
        "description": "Core GitHub API helper with authentication",
        "exports": [
          "get_repo",
          "GithubException"
        ],
        "key_functions": [
          "get_repo() - Get authenticated GitHub repository",
          "Auto-detects from .env or git remote",
          "Handles token authentication"
        ],
        "dependencies": {
          "external": [
            "PyGithub",
            "python-dotenv",
            "GitPython"
          ]
        },
        "used_by": [
          "merge_pr.py",
          "create_pr.py",
          "create_issue.py",
          "read_issues.py",
          "auto_label.py"
        ],
        "criticality": "critical",
        "lines": 150
      },
      "merge_pr.py": {
        "path": ".github/workflows/scripts/merge_pr.py",
        "description": "Merge PR with auto-detection and cleanup",
        "features": [
          "Auto-detect PR from current branch",
          "Squash merge by default",
          "Auto-switch to main and pull",
          "Delete local AND remote branches with --cleanup",
          "Show release status"
        ],
        "usage": "python merge_pr.py [--cleanup] [--pr N]",
        "dependencies": {
          "internal": [
            "github_helper.py"
          ],
          "external": [
            "subprocess",
            "argparse"
          ]
        },
        "criticality": "high",
        "lines": 374,
        "recent_update": "Added remote branch deletion"
      },
      "create_pr.py": {
        "path": ".github/workflows/scripts/create_pr.py",
        "description": "Create PR automatically with validation",
        "features": [
          "Auto-detect branch and base",
          "Validate conventional commit format",
          "Auto-generate description from commits",
          "Link to issues with --closes N",
          "Auto-assign to user",
          "Support draft PRs"
        ],
        "usage": "python create_pr.py --title 'feat: ...' [--closes N]",
        "dependencies": {
          "internal": [
            "github_helper.py"
          ],
          "external": [
            "argparse",
            "subprocess"
          ]
        },
        "criticality": "high",
        "lines": 250
      },
      "create_issue.py": {
        "path": ".github/workflows/scripts/create_issue.py",
        "description": "Create GitHub issue from template or file",
        "features": [
          "Create from markdown file",
          "Create from template",
          "Auto-apply labels",
          "Assign to users",
          "Set milestones"
        ],
        "usage": "python create_issue.py --title '...' --file issue.md",
        "dependencies": {
          "internal": [
            "github_helper.py"
          ]
        },
        "criticality": "medium",
        "lines": 180
      },
      "read_issues.py": {
        "path": ".github/workflows/scripts/read_issues.py",
        "description": "Read and list GitHub issues",
        "features": [
          "List all issues with filters",
          "Read specific issue details",
          "Filter by state (open/closed)",
          "Filter by labels",
          "Show issue metadata"
        ],
        "usage": "python read_issues.py [--list] [--state open] [issue_number]",
        "dependencies": {
          "internal": [
            "github_helper.py"
          ]
        },
        "criticality": "medium",
        "lines": 200
      },
      "auto_label.py": {
        "path": ".github/workflows/scripts/auto_label.py",
        "description": "Automatically label PRs based on files changed",
        "features": [
          "Detect changed files",
          "Apply labels based on patterns",
          "Configurable label rules",
          "Works with PR events"
        ],
        "label_rules": {
          "telegram_bot_stack/": [
            "core",
            "framework"
          ],
          "tests/": [
            "tests"
          ],
          ".github/": [
            "infrastructure"
          ],
          "docs/": [
            "documentation"
          ],
          "examples/": [
            "examples"
          ]
        },
        "dependencies": {
          "internal": [
            "github_helper.py"
          ]
        },
        "criticality": "low",
        "lines": 120
      },
      "analyze_pr.py": {
        "path": ".github/workflows/scripts/analyze_pr.py",
        "description": "Analyze PR changes and provide context",
        "features": [
          "Analyze changed files",
          "Detect impact scope",
          "Suggest reviewers",
          "Estimate complexity"
        ],
        "dependencies": {
          "internal": [
            "github_helper.py",
            "analyze_context.py"
          ]
        },
        "criticality": "low",
        "lines": 200
      },
      "pr_ready.py": {
        "path": ".github/workflows/scripts/pr_ready.py",
        "description": "Check if PR is ready to merge",
        "checks": [
          "CI passing",
          "Conflicts resolved",
          "Reviews approved",
          "Required labels present"
        ],
        "dependencies": {
          "internal": [
            "github_helper.py"
          ]
        },
        "criticality": "medium",
        "lines": 150
      },
      "check_ci.py": {
        "path": ".github/workflows/scripts/check_ci.py",
        "description": "Check CI status for PR or commit",
        "features": [
          "Check workflow status",
          "Wait for workflows to complete",
          "Report failures"
        ],
        "dependencies": {
          "internal": [
            "github_helper.py"
          ]
        },
        "criticality": "medium",
        "lines": 130
      },
      "add_acceptance_criteria.py": {
        "path": ".github/workflows/scripts/add_acceptance_criteria.py",
        "description": "Add acceptance criteria to issues",
        "features": [
          "Parse issue description",
          "Generate acceptance criteria",
          "Update issue with checklist"
        ],
        "dependencies": {
          "internal": [
            "github_helper.py"
          ],
          "external": [
            "openai"
          ]
        },
        "criticality": "low",
        "lines": 180
      },
      "generate_subtasks.py": {
        "path": ".github/workflows/scripts/generate_subtasks.py",
        "description": "Break down issues into subtasks",
        "features": [
          "Analyze issue complexity",
          "Generate subtask list",
          "Create sub-issues if needed"
        ],
        "dependencies": {
          "internal": [
            "github_helper.py"
          ],
          "external": [
            "openai"
          ]
        },
        "criticality": "low",
        "lines": 200
      },
      "analyze_context.py": {
        "path": ".github/workflows/scripts/analyze_context.py",
        "description": "Analyze project context for AI assistance",
        "features": [
          "Gather project info",
          "Analyze recent changes",
          "Provide context for AI"
        ],
        "dependencies": {
          "internal": [
            "github_helper.py"
          ],
          "external": [
            "GitPython"
          ]
        },
        "criticality": "low",
        "lines": 250
      },
      "project_overview.py": {
        "path": ".github/workflows/scripts/project_overview.py",
        "description": "Generate project overview and statistics",
        "features": [
          "Calculate project metrics",
          "Generate overview document",
          "Update project status"
        ],
        "dependencies": {
          "internal": [
            "github_helper.py"
          ]
        },
        "criticality": "low",
        "lines": 150
      },
      "parse_command.py": {
        "path": ".github/workflows/scripts/parse_command.py",
        "description": "Parse and execute commands from issue comments",
        "features": [
          "Parse slash commands",
          "Validate permissions",
          "Execute actions"
        ],
        "dependencies": {
          "internal": [
            "github_helper.py",
            "execute_command.py"
          ]
        },
        "criticality": "low",
        "lines": 120
      },
      "execute_command.py": {
        "path": ".github/workflows/scripts/execute_command.py",
        "description": "Execute automation commands safely",
        "features": [
          "Command execution",
          "Permission checking",
          "Result reporting"
        ],
        "dependencies": {
          "internal": [
            "github_helper.py"
          ]
        },
        "criticality": "low",
        "lines": 140
      }
    }
  },
  "dependency_graph": {
    "core_dependencies": {
      "github_helper.py": {
        "dependents": [
          "merge_pr.py",
          "create_pr.py",
          "create_issue.py",
          "read_issues.py",
          "auto_label.py",
          "analyze_pr.py",
          "pr_ready.py",
          "check_ci.py",
          "add_acceptance_criteria.py",
          "generate_subtasks.py",
          "analyze_context.py",
          "project_overview.py",
          "parse_command.py",
          "execute_command.py"
        ],
        "role": "Foundation for all GitHub API interactions"
      }
    },
    "script_relationships": {
      "merge_pr.py": {
        "depends_on": [
          "github_helper.py"
        ],
        "related_to": [
          "create_pr.py",
          "pr_ready.py"
        ],
        "workflow": "PR merge workflow"
      },
      "create_pr.py": {
        "depends_on": [
          "github_helper.py"
        ],
        "related_to": [
          "merge_pr.py",
          "auto_label.py"
        ],
        "workflow": "PR creation workflow"
      },
      "create_issue.py": {
        "depends_on": [
          "github_helper.py"
        ],
        "related_to": [
          "read_issues.py",
          "add_acceptance_criteria.py"
        ],
        "workflow": "Issue management workflow"
      }
    }
  },
  "workflows_and_automation": {
    "pr_workflow": {
      "description": "Complete PR lifecycle automation",
      "steps": [
        "1. Create PR (create_pr.py)",
        "2. Auto-label (auto_label.py)",
        "3. Analyze changes (analyze_pr.py)",
        "4. Run CI (tests.yml)",
        "5. Check readiness (pr_ready.py)",
        "6. Merge (merge_pr.py)",
        "7. Trigger release (release.yml)"
      ],
      "involved_components": [
        "create_pr.py",
        "auto_label.py",
        "analyze_pr.py",
        "tests.yml",
        "pr_ready.py",
        "merge_pr.py",
        "release.yml"
      ]
    },
    "issue_workflow": {
      "description": "Issue management automation",
      "steps": [
        "1. Create issue (create_issue.py)",
        "2. Add acceptance criteria (add_acceptance_criteria.py)",
        "3. Generate subtasks (generate_subtasks.py)",
        "4. Track progress (read_issues.py)"
      ],
      "involved_components": [
        "create_issue.py",
        "add_acceptance_criteria.py",
        "generate_subtasks.py",
        "read_issues.py"
      ]
    },
    "release_workflow": {
      "description": "Automated release pipeline",
      "steps": [
        "1. Merge to main (merge_pr.py)",
        "2. Tests pass (tests.yml)",
        "3. Semantic release (release.yml)",
        "4. Version bump",
        "5. Create release",
        "6. Publish to PyPI"
      ],
      "involved_components": [
        "merge_pr.py",
        "tests.yml",
        "release.yml"
      ],
      "triggers": "Conventional commits (feat:, fix:, etc.)"
    }
  },
  "configuration_files": {
    ".pre-commit-config.yaml": {
      "description": "Pre-commit hooks configuration",
      "hooks": [
        "trailing-whitespace",
        "end-of-file-fixer",
        "check-yaml",
        "check-added-large-files",
        "ruff-linter",
        "ruff-formatter"
      ],
      "purpose": "Ensure code quality before commit"
    },
    "pyproject.toml": {
      "description": "Project configuration and dependencies",
      "sections": [
        "[build-system]",
        "[project]",
        "[project.optional-dependencies]",
        "[tool.pytest.ini_options]",
        "[tool.coverage]",
        "[tool.ruff]"
      ],
      "purpose": "Central configuration for build, test, lint"
    }
  },
  "ai_agent_hints": {
    "common_tasks": [
      {
        "task": "Modify merge_pr.py",
        "location": ".github/workflows/scripts/merge_pr.py",
        "dependencies": [
          "github_helper.py"
        ],
        "test_locally": "python merge_pr.py --dry-run"
      },
      {
        "task": "Update CI pipeline",
        "location": ".github/workflows/tests.yml",
        "test_locally": "pytest locally first",
        "validation": "Push to branch and check Actions"
      },
      {
        "task": "Add new automation script",
        "steps": [
          "1. Create script in .github/workflows/scripts/",
          "2. Import github_helper",
          "3. Add to infrastructure-graph.json",
          "4. Test locally",
          "5. Create workflow if needed"
        ]
      },
      {
        "task": "Debug CI failure",
        "tools": [
          "check_ci.py",
          "GitHub Actions logs"
        ],
        "approach": "Check workflow file → Check script → Check logs"
      }
    ],
    "quick_reference": {
      "run_tests": "pytest --cov=telegram_bot_stack",
      "check_lint": "ruff check .",
      "format_code": "ruff format .",
      "type_check": "mypy telegram_bot_stack/",
      "pre_commit": "pre-commit run --all-files",
      "merge_pr": "python .github/workflows/scripts/merge_pr.py --cleanup",
      "create_pr": "python .github/workflows/scripts/create_pr.py --title 'feat: ...'",
      "list_issues": "python .github/workflows/scripts/read_issues.py --list"
    }
  },
  "extension_points": {
    "add_workflow": {
      "difficulty": "medium",
      "steps": [
        "1. Create .yml file in .github/workflows/",
        "2. Define triggers and jobs",
        "3. Use existing scripts or create new",
        "4. Test with push to branch",
        "5. Update infrastructure-graph.json"
      ],
      "example": "tests.yml, release.yml"
    },
    "add_automation_script": {
      "difficulty": "low",
      "steps": [
        "1. Create .py in .github/workflows/scripts/",
        "2. Import github_helper for GitHub API",
        "3. Add CLI interface with argparse",
        "4. Document in infrastructure-graph.json",
        "5. Add to workflow if needed"
      ],
      "template": "merge_pr.py structure"
    }
  },
  "troubleshooting": {
    "workflow_not_triggering": {
      "causes": [
        "Wrong trigger event",
        "Branch protection rules",
        "Workflow disabled"
      ],
      "solution": "Check .github/workflows/*.yml triggers"
    },
    "script_fails_locally": {
      "causes": [
        "Missing .env file",
        "No GITHUB_TOKEN",
        "Wrong repository"
      ],
      "solution": "Create .env with GITHUB_TOKEN, check git remote"
    },
    "ci_always_fails": {
      "causes": [
        "Test failures",
        "Linting errors",
        "Coverage below threshold"
      ],
      "solution": "Run locally: pytest, ruff check, coverage report"
    }
  }
}
