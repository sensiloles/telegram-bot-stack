{
  "metadata": {
    "version": "2.0.0",
    "generated_at": "2025-11-17",
    "graph_id": "project_meta",
    "graph_name": "Project Meta & Architecture",
    "graph_type": "specialized",
    "project_name": "telegram-bot-stack",
    "description": "High-level project structure, cross-graph relationships, and architecture overview",
    "scope": "Project-wide structure and component relationships",
    "router_file": "graph-router.json",
    "related_graphs": [
      "All other graphs - this is the meta view"
    ],
    "node_count": 0,
    "edge_count": 0
  },
  "project_overview": {
    "name": "telegram-bot-stack",
    "version": "1.3.0",
    "type": "Python Package / Framework",
    "purpose": "Reusable framework for building production-ready Telegram bots",
    "repository": "https://github.com/sensiloles/telegram-bot-stack",
    "license": "MIT",
    "python_versions": [
      "3.9",
      "3.10",
      "3.11",
      "3.12"
    ]
  },
  "architecture_layers": {
    "layer_1_package": {
      "name": "PyPI Package Core",
      "directory": "telegram_bot_stack/",
      "graph": "bot-framework-graph.json",
      "purpose": "Installable framework package",
      "visibility": "public",
      "components": [
        "BotBase",
        "UserManager",
        "AdminManager",
        "StorageBackend",
        "JSONStorage",
        "MemoryStorage"
      ],
      "design_patterns": [
        "Strategy Pattern (Storage)",
        "Template Method (BotBase hooks)",
        "Dependency Injection (Storage in managers)",
        "Factory Method (create_storage)",
        "Composition (BotBase uses managers)"
      ]
    },
    "layer_2_examples": {
      "name": "Example Implementations",
      "directory": "examples/",
      "graph": "examples-graph.json",
      "purpose": "Demonstrate framework usage",
      "visibility": "public",
      "components": [
        "echo_bot - minimal example",
        "counter_bot - state management",
        "quit_smoking_bot - production example"
      ],
      "learning_progression": "simple \u2192 intermediate \u2192 complex"
    },
    "layer_3_tests": {
      "name": "Testing Infrastructure",
      "directory": "tests/",
      "graph": "testing-graph.json",
      "purpose": "Ensure code quality and correctness",
      "visibility": "internal",
      "components": [
        "Unit tests (tests/core/)",
        "Integration tests (tests/integration/)",
        "Fixtures (conftest.py)"
      ],
      "coverage": "80% (above 79% threshold)"
    },
    "layer_4_infrastructure": {
      "name": "DevOps & Automation",
      "directory": ".github/, scripts/",
      "graph": "infrastructure-graph.json",
      "purpose": "CI/CD, automation, and development tooling",
      "visibility": "internal",
      "components": [
        "GitHub Actions workflows",
        "Automation scripts (16 scripts)",
        "Release automation",
        "PR/Issue management"
      ],
      "automation_level": "extensive"
    }
  },
  "directory_structure": {
    "telegram_bot_stack/": {
      "type": "source",
      "graph": "bot-framework-graph.json",
      "purpose": "Core framework package",
      "published": "PyPI",
      "imports": "pip install telegram-bot-stack"
    },
    "examples/": {
      "type": "documentation",
      "graph": "examples-graph.json",
      "purpose": "Usage examples and learning material",
      "published": "GitHub repository"
    },
    "tests/": {
      "type": "quality_assurance",
      "graph": "testing-graph.json",
      "purpose": "Test suite",
      "published": "GitHub repository"
    },
    ".github/": {
      "type": "infrastructure",
      "graph": "infrastructure-graph.json",
      "purpose": "CI/CD and automation",
      "published": "GitHub repository"
    },
    "docs/": {
      "type": "documentation",
      "graph": "project-meta-graph.json",
      "purpose": "Comprehensive documentation",
      "files": [
        "quickstart.md",
        "api_reference.md",
        "architecture.md",
        "migration_guide.md",
        "installation.md"
      ]
    },
    ".project-graph/": {
      "type": "meta",
      "graph": "All graphs + router",
      "purpose": "Dependency graphs for AI agents",
      "files": [
        "graph-router.json - entry point",
        "bot-framework-graph.json - core framework",
        "infrastructure-graph.json - CI/CD",
        "testing-graph.json - tests",
        "examples-graph.json - examples",
        "project-meta-graph.json - this file"
      ]
    },
    "archive/": {
      "type": "historical",
      "purpose": "Archived documentation and plans",
      "files": [
        "PACKAGE_CONVERSION_PLAN_RU.md - original plan",
        "docker/ - archived Docker setup"
      ]
    }
  },
  "inter_graph_relationships": {
    "bot_framework_to_testing": {
      "relationship": "tested_by",
      "description": "Each framework module has corresponding tests",
      "mapping": {
        "telegram_bot_stack/bot_base.py": "tests/core/test_bot_base.py",
        "telegram_bot_stack/storage/": "tests/core/test_storage.py",
        "telegram_bot_stack/user_manager.py": "tests/core/test_user_manager.py",
        "telegram_bot_stack/admin_manager.py": "tests/core/test_admin_manager.py"
      },
      "coverage": "80%"
    },
    "bot_framework_to_examples": {
      "relationship": "demonstrated_by",
      "description": "Examples show how to use framework",
      "mapping": {
        "BotBase basic usage": "echo_bot",
        "Storage API usage": "counter_bot",
        "Hooks and complex features": "quit_smoking_bot"
      }
    },
    "bot_framework_to_infrastructure": {
      "relationship": "deployed_by",
      "description": "Infrastructure handles framework CI/CD",
      "processes": [
        "tests.yml runs tests on framework code",
        "release.yml publishes framework to PyPI",
        "pre-commit hooks ensure framework code quality"
      ]
    },
    "testing_to_infrastructure": {
      "relationship": "automated_by",
      "description": "Infrastructure runs tests automatically",
      "automation": [
        "tests.yml workflow runs pytest",
        "Coverage reports generated",
        "Results affect PR merge"
      ]
    },
    "all_to_meta": {
      "relationship": "described_by",
      "description": "Meta graph provides overview of all components",
      "purpose": "Onboarding and architecture understanding"
    }
  },
  "data_flow": {
    "user_interaction": {
      "flow": [
        "1. User sends Telegram message",
        "2. python-telegram-bot receives update",
        "3. BotBase routes to appropriate handler",
        "4. Handler uses UserManager/AdminManager",
        "5. Managers use StorageBackend",
        "6. Response sent back to user"
      ],
      "components_involved": [
        "BotBase",
        "UserManager",
        "AdminManager",
        "StorageBackend"
      ]
    },
    "state_persistence": {
      "flow": [
        "1. User data modified in manager",
        "2. Manager calls storage.save(key, data)",
        "3. StorageBackend (JSON/Memory) persists data",
        "4. On restart: storage.load(key) retrieves data"
      ],
      "components_involved": [
        "UserManager",
        "AdminManager",
        "StorageBackend",
        "JSONStorage/MemoryStorage"
      ]
    },
    "development_workflow": {
      "flow": [
        "1. Developer modifies code",
        "2. Pre-commit hooks run (ruff, tests)",
        "3. Push to feature branch",
        "4. GitHub Actions run tests.yml",
        "5. Create PR with create_pr.py",
        "6. Review and merge with merge_pr.py",
        "7. Release workflow publishes to PyPI"
      ],
      "components_involved": [
        "Pre-commit hooks",
        "GitHub Actions workflows",
        "Automation scripts",
        "Release pipeline"
      ]
    }
  },
  "technology_stack": {
    "core_framework": {
      "language": "Python 3.9+",
      "telegram_api": "python-telegram-bot 22.x",
      "async_framework": "asyncio",
      "scheduler": "APScheduler 3.11+",
      "environment": "python-dotenv"
    },
    "development_tools": {
      "linter": "ruff 0.8+",
      "type_checker": "mypy 1.17+",
      "formatter": "ruff format",
      "pre_commit": "pre-commit 3.8+"
    },
    "testing": {
      "framework": "pytest 8.4+",
      "async_support": "pytest-asyncio 0.24+",
      "coverage": "pytest-cov 4.1+",
      "mocking": "pytest-mock 3.12+"
    },
    "ci_cd": {
      "platform": "GitHub Actions",
      "workflows": [
        "tests.yml",
        "release.yml",
        "pr_automation.yml"
      ],
      "release": "semantic-release",
      "versioning": "Conventional Commits"
    },
    "automation": {
      "github_api": "PyGithub 2.1+",
      "git_operations": "GitPython 3.1+",
      "ai_assistance": "openai 1.3+ (optional)"
    },
    "build_and_packaging": {
      "build_system": "setuptools",
      "config_format": "pyproject.toml",
      "package_format": "wheel + sdist",
      "distribution": "PyPI"
    }
  },
  "key_files": {
    "pyproject.toml": {
      "purpose": "Project configuration, dependencies, and build settings",
      "sections": {
        "[build-system]": "Setuptools configuration",
        "[project]": "Package metadata, dependencies",
        "[project.optional-dependencies]": "Dev and GitHub Actions deps",
        "[tool.pytest.ini_options]": "Test configuration",
        "[tool.coverage]": "Coverage settings",
        "[tool.ruff]": "Linting configuration"
      },
      "criticality": "critical"
    },
    "README.md": {
      "purpose": "Main project documentation and entry point",
      "sections": [
        "Quick Start",
        "Features",
        "Installation",
        "Testing",
        "Architecture",
        "Development"
      ],
      "criticality": "high"
    },
    ".cursorrules": {
      "purpose": "AI agent instructions and workflow guidelines",
      "sections": [
        "Agent Orientation",
        "Project Context",
        "Git Workflow",
        "Graph Maintenance",
        "Critical Rules"
      ],
      "criticality": "high"
    },
    ".env": {
      "purpose": "Environment variables (not in repo)",
      "variables": [
        "BOT_TOKEN - Bot token",
        "GITHUB_TOKEN - For automation scripts"
      ],
      "criticality": "critical",
      "security": "gitignored"
    },
    "CHANGELOG.md": {
      "purpose": "Auto-generated changelog from conventional commits",
      "generator": "semantic-release",
      "criticality": "medium"
    }
  },
  "design_decisions": {
    "storage_abstraction": {
      "decision": "Strategy Pattern with StorageBackend interface",
      "rationale": "Allow multiple backends without changing core code",
      "alternatives_considered": [
        "Direct implementation - too rigid",
        "Plugin system - overkill"
      ],
      "documented_in": ".project-graph/future-improvements.md ADR section"
    },
    "admin_protection": {
      "decision": "Cannot remove last admin",
      "rationale": "Prevent admin lockout",
      "implementation": "AdminManager.remove_admin() checks count",
      "trade_off": "Must add new admin before removing last one"
    },
    "hooks_pattern": {
      "decision": "Template Method Pattern with overridable hooks",
      "rationale": "Easy customization without modifying framework",
      "hooks": [
        "on_user_registered",
        "get_user_status",
        "get_welcome_message",
        "register_handlers"
      ]
    },
    "multi_graph_system": {
      "decision": "Split into specialized graphs with router",
      "rationale": "80-90% token savings for AI agents",
      "graphs": [
        "bot-framework-graph.json",
        "infrastructure-graph.json",
        "testing-graph.json",
        "examples-graph.json",
        "project-meta-graph.json"
      ],
      "entry_point": "graph-router.json"
    }
  },
  "ai_agent_hints": {
    "project_onboarding": [
      "1. Read project-meta-graph.json (this file) for overview",
      "2. Read graph-router.json for navigation guide",
      "3. Choose appropriate specialized graph based on task",
      "4. Read .cursorrules for workflow rules",
      "5. Check README.md for quick start"
    ],
    "understanding_architecture": [
      "Start here (project-meta-graph.json)",
      "See architecture_layers for component organization",
      "Check inter_graph_relationships for connections",
      "Review design_decisions for rationale",
      "Dive into specific graphs for details"
    ],
    "cross_component_refactoring": [
      "1. Read project-meta-graph.json for impact scope",
      "2. Check inter_graph_relationships affected",
      "3. Load relevant specialized graphs",
      "4. Update all affected components",
      "5. Update all related graphs",
      "6. Update this meta graph if relationships changed"
    ],
    "adding_major_feature": [
      "1. Determine which layer(s) affected",
      "2. Update bot-framework-graph if core code",
      "3. Add tests \u2192 update testing-graph",
      "4. Add example if significant \u2192 update examples-graph",
      "5. Update infrastructure if CI/CD changes needed",
      "6. Update project-meta if architecture changes"
    ]
  },
  "project_statistics": {
    "total_lines_of_code": {
      "framework": 1233,
      "tests": 1449,
      "examples": 850,
      "infrastructure": 3500,
      "total": 7032
    },
    "total_files": {
      "python": 45,
      "yaml": 3,
      "markdown": 15,
      "json": 8
    },
    "test_coverage": "80%",
    "documentation_coverage": "Extensive",
    "automation_level": "High"
  },
  "scaling_considerations": {
    "adding_storage_backend": {
      "impact": "Low",
      "affected_graphs": [
        "bot-framework-graph.json"
      ],
      "steps": [
        "Implement StorageBackend interface",
        "Add tests",
        "Update bot-framework-graph.json",
        "Optional: add example"
      ]
    },
    "adding_major_component": {
      "impact": "Medium-High",
      "affected_graphs": [
        "bot-framework-graph.json",
        "testing-graph.json",
        "project-meta-graph.json"
      ],
      "steps": [
        "Design component",
        "Implement in telegram_bot_stack/",
        "Add comprehensive tests",
        "Update all relevant graphs",
        "Add example if user-facing",
        "Update documentation"
      ]
    },
    "restructuring_project": {
      "impact": "High",
      "affected_graphs": "All graphs",
      "steps": [
        "Plan changes carefully",
        "Update all specialized graphs",
        "Update inter-graph relationships",
        "Update project-meta-graph",
        "Update router if needed",
        "Update all documentation"
      ]
    }
  },
  "future_directions": {
    "potential_additions": [
      "Additional storage backends (Redis, PostgreSQL)",
      "More example bots",
      "Plugin system",
      "CLI tool for bot scaffolding",
      "Graph visualization tool",
      "Code index generation"
    ],
    "roadmap_file": ".project-graph/future-improvements.md"
  },
  "maintenance_notes": {
    "keep_updated": [
      "Version numbers in metadata",
      "Statistics as project grows",
      "Inter-graph relationships when structure changes",
      "Technology stack versions"
    ],
    "validation": "Use graph_utils.py to validate all graphs",
    "documentation": "README.md in .project-graph/ explains system"
  }
}
