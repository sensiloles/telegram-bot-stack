# ğŸ¤– Cursor Agent Quick Reference

## ğŸ“ START HERE - Agent Orientation

### On Every New Context:
1. **Read:** `.github/PROJECT_STATUS.md` (current phase, open issues)
2. **Check:** `python3 .github/workflows/scripts/read_issues.py --list --state open`
3. **Understand:** Read relevant section of `PACKAGE_CONVERSION_PLAN_RU.md`
4. **Check Git Branch:** Verify not on `main` branch (see Git Workflow below)
5. **Act:** Follow issue checklist or user request

### When User Says "Continue Work":
```bash
# Auto-workflow:
1. Check PROJECT_STATUS.md â†’ current phase
2. List open issues â†’ identify active issue
3. Read issue details â†’ understand task
4. Check plan context â†’ understand why
5. Check current branch â†’ ensure on feature branch
6. Implement â†’ follow issue acceptance criteria
7. Commit â†’ use conventional commits format
```

## ğŸ¯ Project Context (Quick Facts)

**Project:** telegram-bot-stack (reusable Telegram bot framework)
**Current Phase:** Phase 0.3 - Validation & Documentation
**Repository:** https://github.com/sensiloles/telegram-bot-stack
**Master Plan:** `PACKAGE_CONVERSION_PLAN_RU.md` (lines 761-1928)

**Progress:**
- âœ… Phase 0.1: Extract framework â†’ src/core/
- âœ… Phase 0.2: Tests (111 tests, 81% coverage)
- ğŸ”„ Phase 0.3: Validation & docs (current)
- â³ Phase 1: PyPI package release (next)

## ğŸ“š Quick Navigation

| Need | File | Lines |
|------|------|-------|
| Project status | `.github/PROJECT_STATUS.md` | All |
| GitHub automation | `.github/workflows/scripts/README.md` | All |
| Current phase plan | `PACKAGE_CONVERSION_PLAN_RU.md` | 804-847 |
| Architecture | `README.md` | 155-250 |
| Testing guide | `README.md` | 80-154 |
| Git workflow | This file | 50-80 |

## ğŸ”„ Essential Workflows

### Git Workflow (IMPORTANT!)

**âš ï¸ CRITICAL: We use GitHub Flow with branch protection!**

#### For Agent: Optimal Git Workflow

**Rule 1: NEVER push directly to `main`**
- `main` branch is protected
- Direct pushes will be rejected
- Always work in feature branches

**Rule 2: Always check current branch**
```bash
# Before making changes:
git branch --show-current
```

**Rule 3: Create feature branch if needed**
```bash
# If on main or need new feature:
git checkout -b feature/<descriptive-name>
# Or:
git checkout -b fix/<bug-name>
git checkout -b docs/<doc-name>
```

**Rule 4: Make changes and commit**
```bash
# Standard workflow:
1. git status && git diff --stat
2. git log --oneline -5                     # Check commit style
3. Update docs BEFORE commit (if needed)
4. git add .
5. git commit -m "type(scope): description" # Conventional commits!
```

**Rule 5: Push to feature branch**
```bash
# Push feature branch (NOT main):
git push origin feature/<name>
```

**Rule 6: Inform user about PR**
- Tell user PR needs to be created
- Provide branch name
- Mention what was done
- **Include issue reference if working on an issue** (e.g., "Closes #42")
- Don't try to create PR via API (user should review)

### Conventional Commits (REQUIRED!)

**Format:** `type(scope): description`

**Version Impact:**
- `feat:` â†’ MINOR version bump (0.1.0 â†’ 0.2.0)
- `fix:` â†’ PATCH version bump (0.1.0 â†’ 0.1.1)
- `docs:` â†’ No version bump
- `chore:` â†’ No version bump
- `test:` â†’ No version bump
- `refactor:` â†’ No version bump
- `perf:` â†’ PATCH version bump
- `feat!:` or `BREAKING CHANGE:` â†’ MAJOR version bump (0.x.x â†’ 1.0.0)

**Examples:**
- `feat(storage): add Redis backend support`
- `fix(auth): resolve token validation issue`
- `docs(readme): update installation instructions`
- `test(storage): add integration tests`
- `chore(deps): update dependencies`
- `refactor(bot): simplify command handling`

### Agent Decision Tree for Git Operations

```
START
â†“
Is this documentation-only change?
â”œâ”€ YES â†’ Use `docs:` commit type â†’ No version bump
â”œâ”€ NO â†’ Continue
â†“
Is this a new feature?
â”œâ”€ YES â†’ Use `feat:` commit type â†’ MINOR bump
â”œâ”€ NO â†’ Continue
â†“
Is this a bug fix?
â”œâ”€ YES â†’ Use `fix:` commit type â†’ PATCH bump
â”œâ”€ NO â†’ Continue
â†“
Is this maintenance/chores?
â”œâ”€ YES â†’ Use `chore:` commit type â†’ No bump
â”œâ”€ NO â†’ Use best judgment
â†“
COMMIT â†’ PUSH â†’ INFORM USER ABOUT PR
```

### GitHub Issues (Use Scripts)
```bash
# List open issues
python3 .github/workflows/scripts/read_issues.py --list

# Read specific issue
python3 .github/workflows/scripts/read_issues.py 4

# Create issue from file
python3 .github/workflows/scripts/create_issue.py \
--title "Bug: Fix issue" \
--file /tmp/issue.md \
--labels bug,priority:high

# Programmatic (Python)
from github_helper import get_repo
repo = get_repo()                                                # Auto-detects from git
issue = repo.create_issue(title="...", body="...", labels=[...])
```

**See:** `.github/workflows/scripts/README.md` for complete guide.

### Testing
```bash
# Run tests
python3 -m pytest

# With coverage (threshold: 80%)
python3 -m pytest --cov=src/core --cov-report=term

# CI/CD: .github/workflows/tests.yml
```

## âš¡ Critical Rules

### Security
- **NEVER** commit tokens/passwords
- Use `.env` (must be in `.gitignore`)
- Validate tokens at startup

### Code Quality
- All comments/docstrings in **English**
- Use type hints for all new code
- Follow `ruff` linting rules
- Remove unused imports/code immediately

### Documentation
- **UPDATE existing docs**, don't create new ones
- **NEVER create *.md files** unless critically necessary
- Describe work in chat, not in documents
- Keep chat descriptions concise and clear
- Update docs **BEFORE** committing code
- Keep examples executable
- Verify instructions work "out of the box"

### Testing
- Maintain â‰¥80% coverage for `src/core/`
- Write tests for all new features
- Use fixtures from `tests/conftest.py`

## ğŸ—‚ï¸ Project Structure

```
src/
â”œâ”€â”€ core/                # Reusable framework (test coverage 81%)
â”‚ â”œâ”€â”€ bot_base.py      # Base class with hooks
â”‚ â”œâ”€â”€ storage.py       # JSON storage abstraction
â”‚ â”œâ”€â”€ user_manager.py
â”‚ â””â”€â”€ admin_manager.py
â”œâ”€â”€ quit_smoking/        # Bot-specific logic
â”‚ â”œâ”€â”€ bot.py           # Inherits BotBase
â”‚ â””â”€â”€ ...
tests/
â”œâ”€â”€ core/                # Unit tests (100% for storage/managers)
â””â”€â”€ integration/         # E2E tests
```

## ğŸ’¡ Tips for Token Efficiency

**DON'T read entire files unnecessarily:**
- Use `codebase_search` for understanding
- Use `grep` for finding specific code
- Read specific line ranges: `read_file` with offset/limit

**DO read these on start:**
- `.github/PROJECT_STATUS.md` (compact status)
- Current issue via script (structured output)
- Relevant plan section only (not entire file)
- `git branch --show-current` (verify branch)

**Prioritize:**
1. Check git branch â†’ ensure on feature branch
2. Status file (20 lines) â†’ context
3. Issue details (50-100 lines) â†’ task
4. Plan section (50-100 lines) â†’ why
5. Code only when needed â†’ implementation

## ğŸ¯ Agent Optimization Strategies

### When to Create Feature Branch

**Create new branch IF:**
- Currently on `main` branch
- Starting work on new issue/feature
- User says "continue work" and no feature branch exists

**Stay on current branch IF:**
- Already on a feature branch
- Continuing work on same feature
- Branch name matches the work being done

**Branch Naming:**
- `feature/<issue-number>-<short-description>` (e.g., `feature/5-add-redis`)
- `fix/<issue-number>-<short-description>` (e.g., `fix/23-auth-bug`)
- `docs/<description>` (e.g., `docs/update-api-reference`)

### Optimal Commit Strategy

**Single logical change:**
- Make one commit per logical unit of work
- Example: "Add Redis storage backend" (not "Add Redis" + "Add tests" as separate commits)

**Batch related changes:**
- Group related file changes in one commit
- Example: Update README + add example + update docs â†’ one `docs:` commit

**Multiple features in session:**
- If working on multiple unrelated things, ask user:
- "Should I commit feature A before starting feature B?"
- "Should I create separate branches for each feature?"

### When to Push and Inform

**Push after:**
- Completing a logical unit of work
- User asks to "commit" or "save"
- Completing issue checklist item
- Before switching to different task

**Inform user that PR is needed:**
```
âœ… Changes committed to branch `feature/xyz`
ğŸ“ Pushed to origin/feature/xyz
ğŸ”„ Next: Create Pull Request on GitHub
   - Branch: feature/xyz â†’ main
   - In PR description: Add "Closes #N" (if working on issue)
   - All CI checks will run automatically
   - Requires 1 approval before merge
   - Automatic release after merge
   - Issue #N will auto-close on merge
```

### Emergency: If on main branch

**If you accidentally made changes on main:**
```bash
# 1. Check current state
git status

# 2. Create feature branch (takes changes with it)
git checkout -b feature/emergency-branch-name

# 3. Commit on feature branch
git add .
git commit -m "type: description"

# 4. Push feature branch
git push origin feature/emergency-branch-name

# 5. Inform user
```

## ğŸš¨ Critical Git Rules for Agent

1. **NEVER `git push origin main`** - Will fail due to branch protection
2. **ALWAYS check branch** before making changes
3. **ALWAYS use conventional commits** - Enables auto-versioning
4. **INFORM user about PR** - Don't auto-create PRs
5. **BATCH commits** - One commit per logical unit, not per file
6. **UPDATE docs** before committing code changes
7. **RUN tests** before pushing (if applicable)

## ğŸ“‹ Detailed Rules (Reference)

**For complete rules, see archived version:**
- Git workflow details â†’ internal knowledge
- Cleanup procedures â†’ internal knowledge
- Documentation validation â†’ internal knowledge
- Code standards â†’ internal knowledge

**When needed, reference:**
- Conventional Commits: https://www.conventionalcommits.org/
- Pre-commit config: `.pre-commit-config.yaml`
- Test config: `pyproject.toml` [tool.pytest.ini_options]

---

**Remember:** Read `.github/PROJECT_STATUS.md` first on every new context! ğŸ¯
